{% extends 'index.html' %}

{% block content %}
    <style>
        .hidden {
            display: none
        }
    </style>

    {% if message %}
        <p>{{message}}</p>
    {% endif %}
    <div style="margin-top:30px;">
        <form action="" method="post">
            {% csrf_token %} <!-- using this we can use csrf_token in django -->
            <h3>From Using Django Model Form</h3>
            {{ modelform.as_p }} <!--we have to put B/W <form> TAG-->
            <div id="ingredient-form-list">
            {% if modelformset %}
                <h3>Ingredients</h3>
                {{ modelformset.management_form }}
                {% for i_form in modelformset%}
                    <div class="ingredient-form">
                        {{ i_form.as_p}}
                    </div>
                {% endfor %}
            </div>
            {% endif %}
            <div id="empty-form" class="hidden">
                {{ modelformset.empty_form.as_p }}
            </div>
            <button type="button" id="add-more">Add More</button>

            <button type="submit" name="django_model_form" style="margin-top:10px;">Save</button>
        </form>
    </div>

    <script>
        const addMoreBtn = document.getElementById("add-more")
        const totalNewForms = document.getElementById("id_form-TOTAL_FORMS") // form-TOTAL_FORMS
        addMoreBtn.addEventListener('click', add_new_form)

        function add_new_form(event){
            if (event){
                event.preventDefault()
            }
            const currentIngredientForms = document.getElementsByClassName("ingredient-form")
            const currentFormCount = currentIngredientForms.length // + 1

            // ingredient-form-list
            const formCopyTarget = document.getElementById("ingredient-form-list")
            const copyEmptyFormEl = document.getElementById("empty-form").cloneNode(true)
            copyEmptyFormEl.setAttribute('class', 'ingredient-form')  // changing class form hidden to ingredient-form
            copyEmptyFormEl.setAttribute('id', `form-${currentFormCount}`)  // adding uniq id
            const regex = new RegExp('__prefix__','g')
            copyEmptyFormEl.innerHTML = copyEmptyFormEl.innerHTML.replace(regex, currentFormCount)
            totalNewForms.setAttribute('value', currentFormCount + 1)
            formCopyTarget.append(copyEmptyFormEl)
        }
    </script>

{% endblock content %}